import { Row } from './row';
import { Column } from './column';
export class DataSet {
    constructor(data = [], columnSettings) {
        this.columnSettings = columnSettings;
        this.data = [];
        this.columns = [];
        this.rows = [];
        this.willSelect = '';
        this.createColumns(columnSettings);
        this.setData(data);
        this.createNewRow();
    }
    setData(data, selectedRows = []) {
        this.data = data.map((el, index) => {
            const row = new Row(index, el, this);
            row.isSelected = selectedRows.indexOf(el) > -1;
            return row;
        });
        this.createRows();
    }
    getColumns() {
        return this.columns;
    }
    getExpandedRow() {
        if (!this.expandedRow) {
            console.warn('Expanded row not found');
            throw new Error('Expanded row not found');
        }
        return this.expandedRow;
    }
    getSelectedRow() {
        if (!this.selectedRow) {
            console.warn('Selected row not found');
            throw new Error('Selected row not found');
        }
        return this.selectedRow;
    }
    getRows() {
        return this.rows ?? [];
    }
    getFirstRow() {
        return this.rows[0];
    }
    getLastRow() {
        return this.rows[this.rows.length - 1];
    }
    findRowByData(data) {
        const row = this.rows.find((row) => row.getData() === data);
        if (!row) {
            console.warn('Data row not found', data);
            throw new Error('Row not found');
        }
        return row;
    }
    deselectAll() {
        this.rows.forEach((row) => {
            row.isSelected = false;
        });
        // we need to clear selectedRow field because no one row selected
        this.selectedRow = undefined;
    }
    clearExpandAll() {
        this.rows.forEach((row) => {
            row.isExpanded = false;
        });
        // we need to clear selectedRow field because no one row selected
        this.expandedRow = undefined;
    }
    selectRow(row) {
        const previousIsSelected = row.isSelected;
        this.deselectAll();
        row.isSelected = !previousIsSelected;
        this.selectedRow = row;
    }
    multipleSelectRow(row) {
        row.isSelected = !row.isSelected;
        this.selectedRow = row;
    }
    expandRow(row) {
        const previousIsExpanded = row.isExpanded;
        this.clearExpandAll();
        if (row.index !== this.expandedRow?.index) {
            this.expandedRow = undefined;
        }
        row.isExpanded = !previousIsExpanded;
        this.expandedRow = row;
        return this.expandedRow;
    }
    selectPreviousRow() {
        if (this.rows.length > 0) {
            let index = this.selectedRow ? this.selectedRow.index : 0;
            if (index > this.rows.length - 1) {
                index = this.rows.length - 1;
            }
            this.selectRow(this.rows[index]);
            return this.getSelectedRow();
        }
        throw new Error('There are no rows inside the data table');
    }
    selectFirstRow() {
        if (this.rows.length > 0) {
            this.selectRow(this.rows[0]);
            return this.getSelectedRow();
        }
        throw new Error('There are no rows inside the data table');
    }
    selectLastRow() {
        if (this.rows.length > 0) {
            this.selectRow(this.rows[this.rows.length - 1]);
            return this.getSelectedRow();
        }
        throw new Error('There are no rows inside the data table');
    }
    selectRowByIndex(index) {
        const rowsLength = this.rows.length;
        if (rowsLength === 0) {
            throw new Error('There are no rows inside the data table');
        }
        if (!index) {
            this.selectFirstRow();
        }
        else if (index > 0 && index < rowsLength) {
            this.selectRow(this.rows[index]);
        }
        else
            // we need to deselect all rows if we got an incorrect index
            this.deselectAll();
    }
    willSelectFirstRow() {
        this.willSelect = 'first';
    }
    willSelectLastRow() {
        this.willSelect = 'last';
    }
    select(selectedRowIndex) {
        if (this.getRows().length === 0) {
            throw new Error('There are no rows inside the data table');
        }
        if (this.willSelect) {
            if (this.willSelect === 'first') {
                this.selectFirstRow();
            }
            if (this.willSelect === 'last') {
                this.selectLastRow();
            }
            this.willSelect = '';
        }
        else {
            this.selectRowByIndex(selectedRowIndex);
        }
        return this.getSelectedRow();
    }
    createNewRow() {
        this.newRow = new Row(-1, {}, this);
        this.newRow.isInEditing = true;
    }
    /**
     * Create columns by mapping from the settings
     * @param settings
     * @private
     */
    createColumns(settings) {
        for (const id in settings) {
            if (settings.hasOwnProperty(id)) {
                this.columns.push(new Column(id, settings[id], this));
            }
        }
    }
    /**
     * Create rows based on current data prepared in data source
     * @private
     */
    createRows() {
        this.rows = [];
        this.data.forEach((el) => {
            this.rows.push(el);
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YS1zZXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyMi1zbWFydC10YWJsZS9zcmMvbGliL2xpYi9kYXRhLXNldC9kYXRhLXNldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsR0FBRyxFQUFDLE1BQU0sT0FBTyxDQUFDO0FBQzFCLE9BQU8sRUFBQyxNQUFNLEVBQUMsTUFBTSxVQUFVLENBQUM7QUFFaEMsTUFBTSxPQUFPLE9BQU87SUFXbEIsWUFBWSxPQUFtQixFQUFFLEVBQVksY0FBc0I7UUFBdEIsbUJBQWMsR0FBZCxjQUFjLENBQVE7UUFQekQsU0FBSSxHQUFlLEVBQUUsQ0FBQztRQUN0QixZQUFPLEdBQWtCLEVBQUUsQ0FBQztRQUM1QixTQUFJLEdBQWUsRUFBRSxDQUFDO1FBR3RCLGVBQVUsR0FBVyxFQUFFLENBQUM7UUFHaEMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUNuQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRW5CLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN0QixDQUFDO0lBRUQsT0FBTyxDQUFDLElBQWdCLEVBQUUsZUFBMkIsRUFBRTtRQUNyRCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUU7WUFDakMsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNyQyxHQUFHLENBQUMsVUFBVSxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDL0MsT0FBTyxHQUFHLENBQUM7UUFDYixDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUNwQixDQUFD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QU0sRUFBRTtnQkFDOUIsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO2FBQ3RCO1lBQ0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7U0FDdEI7YUFBTTtZQUNMLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1NBQ3pDO1FBRUQsT0FBTyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDL0IsQ0FBQztJQUVELFlBQVk7UUFDVixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNwQyxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7SUFDakMsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxhQUFhLENBQUMsUUFBYTtRQUN6QixLQUFLLE1BQU0sRUFBRSxJQUFJLFFBQVEsRUFBRTtZQUN6QixJQUFJLFFBQVEsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDLEVBQUU7Z0JBQy9CLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksTUFBTSxDQUFDLEVBQUUsRUFBRSxRQUFRLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQzthQUN2RDtTQUNGO0lBQ0gsQ0FBQztJQUVEOzs7T0FHRztJQUNILFVBQVU7UUFDUixJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNmLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUU7WUFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1Jvd30gZnJvbSAnLi9yb3cnO1xuaW1wb3J0IHtDb2x1bW59IGZyb20gJy4vY29sdW1uJztcblxuZXhwb3J0IGNsYXNzIERhdGFTZXQge1xuXG4gIG5ld1JvdyE6IFJvdztcblxuICBwcm90ZWN0ZWQgZGF0YTogQXJyYXk8Um93PiA9IFtdO1xuICBwcm90ZWN0ZWQgY29sdW1uczogQXJyYXk8Q29sdW1uPiA9IFtdO1xuICBwcm90ZWN0ZWQgcm93czogQXJyYXk8Um93PiA9IFtdO1xuICBwcm90ZWN0ZWQgc2VsZWN0ZWRSb3c/OiBSb3c7XG4gIHByb3RlY3RlZCBleHBhbmRlZFJvdz86IFJvdztcbiAgcHJvdGVjdGVkIHdpbGxTZWxlY3Q6IHN0cmluZyA9ICcnO1xuXG4gIGNvbnN0cnVjdG9yKGRhdGE6IEFycmF5PGFueT4gPSBbXSwgcHJvdGVjdGVkIGNvbHVtblNldHRpbmdzOiBPYmplY3QpIHtcbiAgICB0aGlzLmNyZWF0ZUNvbHVtbnMoY29sdW1uU2V0dGluZ3MpO1xuICAgIHRoaXMuc2V0RGF0YShkYXRhKTtcblxuICAgIHRoaXMuY3JlYXRlTmV3Um93KCk7XG4gIH1cblxuICBzZXREYXRhKGRhdGE6IEFycmF5PGFueT4sIHNlbGVjdGVkUm93czogQXJyYXk8YW55PiA9IFtdKSB7XG4gICAgdGhpcy5kYXRhID0gZGF0YS5tYXAoKGVsLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3Qgcm93ID0gbmV3IFJvdyhpbmRleCwgZWwsIHRoaXMpO1xuICAgICAgcm93LmlzU2VsZWN0ZWQgPSBzZWxlY3RlZFJvd3MuaW5kZXhPZihlbCkgPiAtMTtcbiAgICAgIHJldHVybiByb3c7XG4gICAgfSk7XG4gICAgdGhpcy5jcmVhdGVSb3dzKCk7XG4gIH1cblxuICBnZXRDb2x1bW5zKCk6IEFycmF5PENvbHVtbj4ge1xuICAgIHJldHVybiB0aGlzLmNvbHVtbnM7XG4gIH1cblxuICBnZXRFeHBhbmRlZFJvdygpOiBSb3cge1xuICAgIGlmICghdGhpcy5leHBhbmRlZFJvdykge1xuICAgICAgY29uc29sZS53YXJuKCdFeHBhbmRlZCByb3cgbm90IGZvdW5kJyk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGFuZGVkIHJvdyBub3QgZm91bmQnKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZXhwYW5kZWRSb3c7XG4gIH1cblxuICBnZXRTZWxlY3RlZFJvdygpOiBSb3cge1xuICAgIGlmICghdGhpcy5zZWxlY3RlZFJvdykge1xuICAgICAgY29uc29sZS53YXJuKCdTZWxlY3RlZCByb3cgbm90IGZvdW5kJyk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlbGVjdGVkIHJvdyBub3QgZm91bmQnKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRSb3c7XG4gIH1cblxuICBnZXRSb3dzKCk6IEFycmF5PFJvdz4ge1xuICAgIHJldHVybiB0aGlzLnJvd3MgPz8gW107XG4gIH1cblxuICBnZXRGaXJzdFJvdygpOiBSb3cge1xuICAgIHJldHVybiB0aGlzLnJvd3NbMF07XG4gIH1cblxuICBnZXRMYXN0Um93KCk6IFJvdyB7XG4gICAgcmV0dXJuIHRoaXMucm93c1t0aGlzLnJvd3MubGVuZ3RoIC0gMV07XG4gIH1cblxuICBmaW5kUm93QnlEYXRhKGRhdGE6IGFueSk6IFJvdyB7XG4gICAgY29uc3Qgcm93ID0gdGhpcy5yb3dzLmZpbmQoKHJvdzogUm93KSA9PiByb3cuZ2V0RGF0YSgpID09PSBkYXRhKTtcbiAgICBpZiAoIXJvdykge1xuICAgICAgY29uc29sZS53YXJuKCdEYXRhIHJvdyBub3QgZm91bmQnLCBkYXRhKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUm93IG5vdCBmb3VuZCcpO1xuICAgIH1cbiAgICByZXR1cm4gcm93O1xuICB9XG5cbiAgZGVzZWxlY3RBbGwoKSB7XG4gICAgdGhpcy5yb3dzLmZvckVhY2goKHJvdykgPT4ge1xuICAgICAgcm93LmlzU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICB9KTtcbiAgICAvLyB3ZSBuZWVkIHRvIGNsZWFyIHNlbGVjdGVkUm93IGZpZWxkIGJlY2F1c2Ugbm8gb25lIHJvdyBzZWxlY3RlZFxuICAgIHRoaXMuc2VsZWN0ZWRSb3cgPSB1bmRlZmluZWQ7XG4gIH1cblxuICBjbGVhckV4cGFuZEFsbCgpIHtcbiAgICB0aGlzLnJvd3MuZm9yRWFjaCgocm93KSA9PiB7XG4gICAgICByb3cuaXNFeHBhbmRlZCA9IGZhbHNlO1xuICAgIH0pO1xuICAgIC8vIHdlIG5lZWQgdG8gY2xlYXIgc2VsZWN0ZWRSb3cgZmllbGQgYmVjYXVzZSBubyBvbmUgcm93IHNlbGVjdGVkXG4gICAgdGhpcy5leHBhbmRlZFJvdyA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHNlbGVjdFJvdyhyb3c6IFJvdyk6IHZvaWQge1xuICAgIGNvbnN0IHByZXZpb3VzSXNTZWxlY3RlZCA9IHJvdy5pc1NlbGVjdGVkO1xuICAgIHRoaXMuZGVzZWxlY3RBbGwoKTtcblxuICAgIHJvdy5pc1NlbGVjdGVkID0gIXByZXZpb3VzSXNTZWxlY3RlZDtcbiAgICB0aGlzLnNlbGVjdGVkUm93ID0gcm93O1xuICB9XG5cbiAgbXVsdGlwbGVTZWxlY3RSb3cocm93OiBSb3cpOiB2b2lkIHtcbiAgICByb3cuaXNTZWxlY3RlZCA9ICFyb3cuaXNTZWxlY3RlZDtcbiAgICB0aGlzLnNlbGVjdGVkUm93ID0gcm93O1xuICB9XG5cbiAgZXhwYW5kUm93KHJvdzogUm93KTogUm93IHtcbiAgICBjb25zdCBwcmV2aW91c0lzRXhwYW5kZWQgPSByb3cuaXNFeHBhbmRlZDtcbiAgICB0aGlzLmNsZWFyRXhwYW5kQWxsKCk7XG4gICAgaWYgKHJvdy5pbmRleCAhPT0gdGhpcy5leHBhbmRlZFJvdz8uaW5kZXgpIHtcbiAgICAgIHRoaXMuZXhwYW5kZWRSb3cgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHJvdy5pc0V4cGFuZGVkID0gIXByZXZpb3VzSXNFeHBhbmRlZDtcbiAgICB0aGlzLmV4cGFuZGVkUm93ID0gcm93O1xuICAgIHJldHVybiB0aGlzLmV4cGFuZGVkUm93O1xuICB9XG5cbiAgc2VsZWN0UHJldmlvdXNSb3coKTogUm93IHtcbiAgICBpZiAodGhpcy5yb3dzLmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBpbmRleCA9IHRoaXMuc2VsZWN0ZWRSb3cgPyB0aGlzLnNlbGVjdGVkUm93LmluZGV4IDogMDtcbiAgICAgIGlmIChpbmRleCA+IHRoaXMucm93cy5sZW5ndGggLSAxKSB7XG4gICAgICAgIGluZGV4ID0gdGhpcy5yb3dzLmxlbmd0aCAtIDE7XG4gICAgICB9XG4gICAgICB0aGlzLnNlbGVjdFJvdyh0aGlzLnJvd3NbaW5kZXhdKTtcbiAgICAgIHJldHVybiB0aGlzLmdldFNlbGVjdGVkUm93KCk7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcignVGhlcmUgYXJlIG5vIHJvd3MgaW5zaWRlIHRoZSBkYXRhIHRhYmxlJyk7XG4gIH1cblxuICBzZWxlY3RGaXJzdFJvdygpOiBSb3cge1xuICAgIGlmICh0aGlzLnJvd3MubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5zZWxlY3RSb3codGhpcy5yb3dzWzBdKTtcbiAgICAgIHJldHVybiB0aGlzLmdldFNlbGVjdGVkUm93KCk7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcignVGhlcmUgYXJlIG5vIHJvd3MgaW5zaWRlIHRoZSBkYXRhIHRhYmxlJyk7XG4gIH1cblxuICBzZWxlY3RMYXN0Um93KCk6IFJvdyB7XG4gICAgaWYgKHRoaXMucm93cy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLnNlbGVjdFJvdyh0aGlzLnJvd3NbdGhpcy5yb3dzLmxlbmd0aCAtIDFdKTtcbiAgICAgIHJldHVybiB0aGlzLmdldFNlbGVjdGVkUm93KCk7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcignVGhlcmUgYXJlIG5vIHJvd3MgaW5zaWRlIHRoZSBkYXRhIHRhYmxlJyk7XG4gIH1cblxuICBzZWxlY3RSb3dCeUluZGV4KGluZGV4PzogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3Qgcm93c0xlbmd0aDogbnVtYmVyID0gdGhpcy5yb3dzLmxlbmd0aDtcbiAgICBpZiAocm93c0xlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGVyZSBhcmUgbm8gcm93cyBpbnNpZGUgdGhlIGRhdGEgdGFibGUnKTtcbiAgICB9XG4gICAgaWYgKCFpbmRleCkge1xuICAgICAgdGhpcy5zZWxlY3RGaXJzdFJvdygpO1xuICAgIH0gZWxzZSBpZiAoaW5kZXggPiAwICYmIGluZGV4IDwgcm93c0xlbmd0aCkge1xuICAgICAgdGhpcy5zZWxlY3RSb3codGhpcy5yb3dzW2luZGV4XSk7XG4gICAgfSBlbHNlXG4gICAgICAvLyB3ZSBuZWVkIHRvIGRlc2VsZWN0IGFsbCByb3dzIGlmIHdlIGdvdCBhbiBpbmNvcnJlY3QgaW5kZXhcbiAgICAgIHRoaXMuZGVzZWxlY3RBbGwoKTtcbiAgfVxuXG4gIHdpbGxTZWxlY3RGaXJzdFJvdygpIHtcbiAgICB0aGlzLndpbGxTZWxlY3QgPSAnZmlyc3QnO1xuICB9XG5cbiAgd2lsbFNlbGVjdExhc3RSb3coKSB7XG4gICAgdGhpcy53aWxsU2VsZWN0ID0gJ2xhc3QnO1xuICB9XG5cbiAgc2VsZWN0KHNlbGVjdGVkUm93SW5kZXg/OiBudW1iZXIpOiBSb3cge1xuICAgIGlmICh0aGlzLmdldFJvd3MoKS5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGhlcmUgYXJlIG5vIHJvd3MgaW5zaWRlIHRoZSBkYXRhIHRhYmxlJyk7XG4gICAgfVxuICAgIGlmICh0aGlzLndpbGxTZWxlY3QpIHtcbiAgICAgIGlmICh0aGlzLndpbGxTZWxlY3QgPT09ICdmaXJzdCcpIHtcbiAgICAgICAgdGhpcy5zZWxlY3RGaXJzdFJvdygpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMud2lsbFNlbGVjdCA9PT0gJ2xhc3QnKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0TGFzdFJvdygpO1xuICAgICAgfVxuICAgICAgdGhpcy53aWxsU2VsZWN0ID0gJyc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VsZWN0Um93QnlJbmRleChzZWxlY3RlZFJvd0luZGV4KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5nZXRTZWxlY3RlZFJvdygpO1xuICB9XG5cbiAgY3JlYXRlTmV3Um93KCkge1xuICAgIHRoaXMubmV3Um93ID0gbmV3IFJvdygtMSwge30sIHRoaXMpO1xuICAgIHRoaXMubmV3Um93LmlzSW5FZGl0aW5nID0gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgY29sdW1ucyBieSBtYXBwaW5nIGZyb20gdGhlIHNldHRpbmdzXG4gICAqIEBwYXJhbSBzZXR0aW5nc1xuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgY3JlYXRlQ29sdW1ucyhzZXR0aW5nczogYW55KSB7XG4gICAgZm9yIChjb25zdCBpZCBpbiBzZXR0aW5ncykge1xuICAgICAgaWYgKHNldHRpbmdzLmhhc093blByb3BlcnR5KGlkKSkge1xuICAgICAgICB0aGlzLmNvbHVtbnMucHVzaChuZXcgQ29sdW1uKGlkLCBzZXR0aW5nc1tpZF0sIHRoaXMpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIHJvd3MgYmFzZWQgb24gY3VycmVudCBkYXRhIHByZXBhcmVkIGluIGRhdGEgc291cmNlXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBjcmVhdGVSb3dzKCkge1xuICAgIHRoaXMucm93cyA9IFtdO1xuICAgIHRoaXMuZGF0YS5mb3JFYWNoKChlbCkgPT4ge1xuICAgICAgdGhpcy5yb3dzLnB1c2goZWwpO1xuICAgIH0pO1xuICB9XG59XG4iXX0=